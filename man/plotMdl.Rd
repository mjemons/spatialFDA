% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plotMdl.R
\name{plotMdl}
\alias{plotMdl}
\title{Plot a pffr model object}
\usage{
plotMdl(mdl, predictor)
}
\arguments{
\item{mdl}{a pffr model object}

\item{predictor}{predictor to plot}
}
\value{
ggplot object of the functional estimate
}
\description{
Plot a pffr model object
}
\examples{
 library('tidyr')
 library('stringr')
 library('dplyr')
 spe <- imcdatasets::Damond_2019_Pancreas("spe", full_dataset = FALSE)
 metric_res <- calcMetricPerFov(spe, c('alpha', 'beta'),
 subsetby = 'image_number',fun = 'Gcross', marks = 'cell_type',
 r_seq = seq(0,50, length.out = 50), by = c('patient_stage', 'patient_id'),
 ncores = 2)
#create a unique ID for each row
metric_res$ID <- paste0(metric_res$patient_stage,'x' ,metric_res$patient_id,
                        'x', metric_res$image_id)

dat <- prepData(metric_res, 'r', 'rs')

#create meta info of the IDs
split_data <- str_split(dat$ID, "x")
dat$condition <- factor(sapply(split_data, `[`, 1))
dat$patient_id <- factor(sapply(split_data, `[`, 2))
dat$image_id <- factor(sapply(split_data, `[`, 3))
#create a designmatrix
condition <- dat$condition
#relevel the condition - can set explicit contrasts here
condition <- relevel(condition, 'Non-diabetic')
designmat <- model.matrix( ~ condition)
#colnames don't work with the '-' sign
colnames(designmat) <- c('Intercept', 'conditionLong_duration', 'conditionOnset')
#fit the model
mdl <- functionalGam(dat = dat, x = metric_res$r |> unique(),
                     designmat = designmat, weights = dat$weights$npoints,
                     formula = formula(Y ~ conditionLong_duration +
                                         conditionOnset + s(patient_id,  bs='re')))
summary(mdl)
plot_ls <- lapply(colnames(designmat), plotMdl, mdl = mdl)
}
